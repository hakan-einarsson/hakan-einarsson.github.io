var mt=Object.defineProperty;var wt=(s,t,i)=>t in s?mt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i;var m=(s,t,i)=>(wt(s,typeof t!="symbol"?t+"":t,i),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))e(h);new MutationObserver(h=>{for(const n of h)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function i(h){const n={};return h.integrity&&(n.integrity=h.integrity),h.referrerPolicy&&(n.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?n.credentials="include":h.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(h){if(h.ep)return;h.ep=!0;const n=i(h);fetch(h.href,n)}})();/**
 * @preserve
 * Kontra.js v9.0.0
 */let j=()=>{};let X={};function at(s,t){X[s]=X[s]||[],X[s].push(t)}function ct(s,...t){(X[s]||[]).map(i=>i(...t))}let W,N,it={get(s,t){return t=="_proxy"?!0:j}};function Y(){return N}function yt(s,{contextless:t=!1}={}){return W=document.getElementById(s)||s||document.querySelector("canvas"),t&&(W=W||new Proxy({},it)),N=W.getContext("2d")||new Proxy({},it),N.imageSmoothingEnabled=!1,ct("init"),{canvas:W,context:N}}class Q{constructor({spriteSheet:t,frames:i,frameRate:e,loop:h=!0,name:n}){let{width:r,height:d,margin:a=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:i,frameRate:e,loop:h,name:n,width:r,height:d,margin:a,isStopped:!1,_f:0,_a:0})}clone(){return new Q(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:i,width:e=this.width,height:h=this.height,context:n=Y()}){let r=this.frames[this._f]/this.spriteSheet._f|0,d=this.frames[this._f]%this.spriteSheet._f|0;n.drawImage(this.spriteSheet.image,d*this.width+(d*2+1)*this.margin,r*this.height+(r*2+1)*this.margin,this.width,this.height,t,i,e,h)}}function St(){return new Q(...arguments)}class J{constructor(t=0,i=0,e={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i)}set(t){this.x=t.x,this.y=t.y}add(t){return new J(this.x+t.x,this.y+t.y,this)}}function et(){return new J(...arguments)}class Ct{constructor(t){return this.init(t)}init(t={}){this.position=et(),this.velocity=et(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.velocity;this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}isAlive(){return this.ttl>0}_pc(){}}class vt extends Ct{init({width:t=0,height:i=0,context:e=Y(),render:h=this.draw,update:n=this.advance,anchor:r={x:0,y:0},scaleX:d=1,scaleY:a=1,...f}={}){super.init({width:t,height:i,context:e,anchor:r,scaleX:d,scaleY:a,...f}),this._di=!0,this._uw(),this._rf=h,this._uf=n,at("init",()=>{this.context??(this.context=Y())})}update(t){this._uf(t)}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let i=-this.width*this.anchor.x,e=-this.height*this.anchor.y;(i||e)&&t.translate(i,e),this._rf(),(i||e)&&t.translate(-i,-e),t.restore()}draw(){}_pc(){this._uw()}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wsx:e=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wsx=e*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*e,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,scaleX:this._wsx,scaleY:this._wsy}}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class Tt extends vt{init({image:t,width:i=t?t.width:void 0,height:e=t?t.height:void 0,...h}={}){super.init({image:t,width:i,height:e,...h})}get animations(){return this._a}set animations(t){let i,e;this._a={};for(i in t)this._a[i]=t[i].clone(),e=e||this._a[i];this.currentAnimation=e,this.width=this.width||e.width,this.height=this.height||e.height}playAnimation(t){var i;(i=this.currentAnimation)==null||i.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var i;super.advance(t),(i=this.currentAnimation)==null||i.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function T(){return new Tt(...arguments)}function Mt(s){let t=s.canvas;s.clearRect(0,0,t.width,t.height)}function It({fps:s=60,clearCanvas:t=!0,update:i=j,render:e,context:h=Y(),blur:n=!1}={}){let r=0,d=1e3/s,a=1/s,f=t?Mt:j,p,o,c,l,x,w=!0;n||(window.addEventListener("focus",()=>{w=!0}),window.addEventListener("blur",()=>{w=!1})),at("init",()=>{x.context??(x.context=Y())});function C(){if(o=requestAnimationFrame(C),!!w&&(c=performance.now(),l=c-p,p=c,!(l>1e3))){for(ct("tick"),r+=l;r>=d;)x.update(a),r-=d;f(x.context),x.render()}}return x={update:i,render:e,isStopped:!0,context:h,start(){p=performance.now(),this.isStopped=!1,requestAnimationFrame(C)},stop(){this.isStopped=!0,cancelAnimationFrame(o)}},x}function bt(s){if(+s==s)return s;let t=[],i=s.split(".."),e=+i[0],h=+i[1],n=e;if(e<h)for(;n<=h;n++)t.push(n);else for(;n>=h;n--)t.push(n);return t}class Pt{constructor({image:t,frameWidth:i,frameHeight:e,frameMargin:h,animations:n}={}){this.animations={},this.image=t,this.frame={width:i,height:e,margin:h},this._f=t.width/i|0,this.createAnimations(n)}createAnimations(t){let i,e;for(e in t){let{frames:h,frameRate:n,loop:r}=t[e];i=[],[].concat(h).map(d=>{i=i.concat(bt(d))}),this.animations[e]=St({spriteSheet:this,frames:i,frameRate:n,loop:r,name:e})}}}function lt(){return new Pt(...arguments)}const Et="/assets/t.png";function _t(){return Gt(Et).then(s=>Promise.all([st(s,0,0,96,32),st(s,0,32,240,22)]))}function Gt(s){return new Promise((t,i)=>{const e=new Image;e.onload=()=>t(e),e.onerror=h=>i(h),e.src=s})}function st(s,t,i,e,h){return new Promise(n=>{const r=document.createElement("canvas"),d=r.getContext("2d");r.width=e,r.height=h,d.drawImage(s,t,i,e,h,0,0,e,h);const a=new Image;a.onload=()=>n(a),a.src=r.toDataURL()})}const L={" ":!1,e:!1,q:!1};document.addEventListener("keydown",s=>{L[s.key]=!0});document.addEventListener("keyup",s=>{L[s.key]=!1});function I(s){return!!L[s]}function Ot(){return Object.fromEntries(Object.entries(L).filter(([s])=>s===" "||s==="e"||s==="q"))}const ht=16;function kt(s){let t={x:0,y:0};(I("ArrowDown")||I("s"))&&(t.y+=1),(I("ArrowUp")||I("w"))&&(t.y-=1),(I("ArrowLeft")||I("a"))&&(t.x-=1),(I("ArrowRight")||I("d"))&&(t.x+=1),t=Rt(t),s.mx=t.x,s.my=t.y}function zt(){return!!I(" ")}function At(){return!!(I("e")||I(" ")||I("q"))}function Rt(s){return s.x!==0&&s.y!==0&&(s.x*=.7,s.y*=.7),s}function nt(s,t,i){if(i===void 0)return!1;const e=s.x,h=s.y;for(const n of i){const r={left:n.x,right:n.x+ht,top:n.y,bottom:n.y+ht};if(Wt({x:e,y:h,radius:t},r))return!0}return!1}function Wt(s,t){const i=Math.max(t.left,Math.min(s.x,t.right)),e=Math.max(t.top,Math.min(s.y,t.bottom)),h=s.x-i,n=s.y-e;return h*h+n*n<s.radius*s.radius}function $(...s){return Yt.play(...s)}const Yt={volume:.3,sampleRate:44100,x:new AudioContext,play:function(...s){return this.playSamples(this.buildSamples(...s))},playSamples:function(...s){const t=this.x.createBuffer(s.length,s[0].length,this.sampleRate),i=this.x.createBufferSource();return s.map((e,h)=>t.getChannelData(h).set(e)),i.buffer=t,i.connect(this.x.destination),i.start(),i},buildSamples:function(s=1,t=.05,i=220,e=0,h=0,n=.1,r=0,d=1,a=0,f=0,p=0,o=0,c=0,l=0,x=0,w=0,C=0,M=1,P=0,O=0){let y=Math.PI*2,v=this.sampleRate,q=xt=>xt>0?1:-1,z=a*=500*y/v/v,F=i*=(1+t*2*Math.random()-t)*y/v,_=[],E=0,U=0,g=0,b=1,A=0,k=0,u=0,R,G;for(e=e*v+9,P*=v,h*=v,n*=v,C*=v,f*=500*y/v**3,x*=y/v,p*=y/v,o*=v,c=c*v|0,G=e+P+h+n+C|0;g<G;_[g++]=u)++k%(w*100|0)||(u=r?r>1?r>2?r>3?Math.sin((E%y)**3):Math.max(Math.min(Math.tan(E),1),-1):1-(2*E/y%2+2)%2:1-4*Math.abs(Math.round(E/y)-E/y):Math.sin(E),u=(c?1-O+O*Math.sin(y*g/c):1)*q(u)*Math.abs(u)**d*s*this.volume*(g<e?g/e:g<e+P?1-(g-e)/P*(1-M):g<e+P+h?M:g<G-C?(G-g-C)/n*M:0),u=C?u/2+(C>g?0:(g<G-C?1:(G-g)/C)*_[g-C|0]/2):u),R=(i+=a+=f)*Math.cos(x*U++),E+=R-R*l*(1-(Math.sin(g)+1)*1e9%2),b&&++b>o&&(i+=p,F+=p,b=0),c&&!(++A%c)&&(i=F,a=z,b||(b=1));return _},getNote:function(s=0,t=440){return t*2**(s/12)}};function Bt(){$(1.4,0,406,.06,.02,.04,void 0,.6,void 0,void 0,void 0,void 0,.01,void 0,void 0,void 0,.06,.52,.01,.49)}function Dt(){$(.4,0,816,.03,void 0,.19,2,.39,void 0,void 0,void 0,void 0,void 0,1.5,void 0,1,void 0,.2,.18,.4)}function Xt(){$(1.2,0,127,.01,.22,.41,3,3.28,1,.6,void 0,void 0,void 0,.5,void 0,.7,.23,.42,.15)}function Nt(){$(.6,0,413,.01,.06,.05,void 0,1.02,1.4,-.1,void 0,void 0,void 0,1.2,void 0,void 0,.17,.96,.08)}function dt(s,t,i,e,h,n,r,d){return T({x:s,y:t,gx:i,gy:e,animations:h,radius:n,mx:0,my:0,anchor:{x:.5,y:.7},speed:r,normalSpeed:r,health:d,maxHealth:d,boundingObstacles:[],cooldowns:[0,0,0,0,0,0],moveX:0,moveY:0,score:0,isTakingDamage:!1,moveUnit(a){this.setMovement(a),nt({x:this.gx+this.moveX,y:this.gy},this.radius,this.boundingObstacles)||(this.gx+=this.moveX),nt({x:this.gx,y:this.gy+this.moveY},this.radius,this.boundingObstacles)||(this.gy+=this.moveY)},setMovement(a){if(a===void 0)return;const f=this.speed*a;this.moveX=f*this.mx,this.moveY=f*this.my},getBounds(){return{left:this.gx-this.radius,right:this.gx+this.radius,top:this.gy-this.radius,bottom:this.gy+this.radius}},getExtendedBounds(a){let f=this.getBounds();return{left:f.left-a,right:f.right+a,top:f.top-a,bottom:f.bottom+a}},setBoundingObstacles(a){this.boundingObstacles=a},setAnimation(){this.moveX<0?this.setScale(-1,1):this.moveX>0&&this.setScale(1,1),this.isTakingDamage?this.playAnimation(this.hurt):this.moveX!=0||this.moveY!=0?this.playAnimation(this.walk):this.playAnimation(this.idle)},getPosition(){return{x:this.gx,y:this.gy}},getScreenPosition(){return{x:this.x,y:this.y}},takeDamage(a){this.health-=a,this.isTakingDamage=!0,this.cooldowns[4]=.5,this.cooldowns[5]=1,Dt()},updateCooldowns(a){for(let f=0;f<this.cooldowns.length;f++)this.cooldowns[f]>0?this.cooldowns[f]-=a:this.cooldowns[f]=0}})}function Lt(s,t,i,e){const h=dt(i.width/2,i.height/2,s-4,t-5,e,5,60,100);return h.idle="idle",h.walk="walk",h.hurt="hurt",h.initialPosition={x:s,y:t},h.vcb=!1,h.tc=!1,h.getScreenBounds=function(){return{left:this.gx-i.width/2,right:this.gx+i.width/2,top:this.gy-i.height/2,bottom:this.gy+i.height/2}},h.reduceSpeedIfTakingDamage=function(){this.cooldowns[5]>0&&(this.speed=this.normalSpeed*.7)},h.reset=function(){this.cooldowns[5]===0&&this.speed!==this.normalSpeed&&(this.speed=this.normalSpeed,this.isTakingDamage=!1)},h.resetLevel=function(){this.x=i.width/2,this.y=i.height/2,this.setScale(1,1),this.gx=this.initialPosition.x,this.gy=this.initialPosition.y,this.health=this.maxHealth,this.isTakingDamage=!1,this.speed=this.normalSpeed,this.cooldowns=[0,0,0,.5,0,0],this.score=0},h}function K(s,t,i,e,h,n){const r=dt(s,t,s,t,n,5,h,100);return r.canvas=e,r.target=i,r.isTarget=!1,r.damage=5,r.onCooldown=!1,r.cooldownTime=1,r.cooldownCounter=0,r.isInViewPort=!1,r.idle="zI",r.walk="zombieWalk",r.hurt="zH",r.getDistanceToTarget=function(){return Math.sqrt(Math.pow(this.gx-this.target.gx,2)+Math.pow(this.gy-this.target.gy,2))},r.setMovement=function(d){if(d===void 0)return;const a=this.target.gx-this.gx,f=this.target.gy-this.gy,p=Math.sqrt(a*a+f*f);this.moveX=a/p*this.speed*d,this.moveY=f/p*this.speed*d},r.setScreenPosition=function(){this.x=this.gx-this.target.gx+e.width/2,this.y=this.gy-this.target.gy+e.height/2},r.drawTargetMark=function(){this.context.strokeStyle="#ff0000",this.context.lineWidth=2,this.context.beginPath(),this.context.arc(this.x,this.y,this.radius*2,0,2*Math.PI),this.context.stroke()},r.checkIfWithinViewport=function(){this.isInViewPort=this.x+this.radius>=0&&this.x-this.radius<e.width&&this.y+this.radius>=0&&this.y-this.radius<e.height},r.isPointInside=function(d,a){return Math.sqrt(Math.pow(d-this.x,2)+Math.pow(a-(this.y-4),2))<this.radius+4},r}function rt(s){return T({x:0,y:0,animations:s,anchor:{x:.5,y:.5}})}function H(s,t,i){return s.filter(e=>{let h={left:e.x,right:e.x+i,top:e.y,bottom:e.y+i};return ft(t,h)})}function $t(s,t){return s.filter(i=>{let e=i.getBounds();return ft(t,e)})}function ft(s,t){return!(t.left>s.right||t.right<s.left||t.top>s.bottom||t.bottom<s.top)}function qt(s,t,i,e,h){const n=i*2,r={left:s.gx-t.width/2+n,right:s.gx+t.width/2-n,top:s.gy-t.height/2+n,bottom:s.gy+t.height/2-n};let d=Math.random()*(70-30)+30,a=Math.random()*(r.right-r.left)+r.left,f=Math.random()*(r.bottom-r.top)+r.top;do a=Math.random()*(r.right-r.left)+r.left,f=Math.random()*(r.bottom-r.top)+r.top;while(Ft(a,f,s,n)||Ut(a,f,e,i));return K(a,f,s,t,d,h)}function Ft(s,t,i,e){return Math.abs(s-i.gx)<e&&Math.abs(t-i.gy)<e}function Ut(s,t,i,e){for(let n of i)if(s+7>n.x&&s<n.x+e&&t+7>n.y&&t<n.y+e)return!0;return!1}function Ht(s,t){const i=t.x-s.x,e=t.y-s.y,h=Math.sqrt(i*i+e*e);return{x:i/h,y:e/h}}function tt(s,t){const i=s.position.x-t.position.x,e=s.position.y-t.position.y;return Math.sqrt(i*i+e*e)<s.radius+t.radius}function B(s){return{position:{x:s.gx,y:s.gy},radius:s.radius}}class Vt{constructor(t,i,e){m(this,"tileSize");m(this,"tileSheet");m(this,"tiles");m(this,"actualTileSize");this.tileSize=t,this.tileSheet=i,this.tiles=e,this.actualTileSize=16}drawTile(t,i,e,h,n,r=0){if(!t)return;const d=this.tiles[e];if(d&&(d.background&&(t.fillStyle=d.background,t.fillRect(h*this.tileSize,n*this.tileSize,this.tileSize,this.tileSize)),d.x!==void 0&&d.y!==void 0)){const a=d.x*this.tileSize,f=d.y*this.tileSize;if(r!==0)this.drawRotatedTile(t,{x:d.x,y:d.y},h,n,r);else if(e==="t"){let p=1,o=1;t.drawImage(this.tileSheet,16*4,19,this.tileSize*2,13,(h-p)*this.tileSize+this.tileSize/2,(n-o)*this.tileSize+19,this.tileSize*2,13),i==null||i.drawImage(this.tileSheet,16*4,0,32,19,(h-p)*this.tileSize+this.tileSize/2,(n-o)*this.tileSize,32,19)}else t.drawImage(this.tileSheet,a,f,this.tileSize,this.tileSize,h*this.tileSize,n*this.tileSize,this.tileSize,this.tileSize)}}drawRotatedTile(t,i,e,h,n=0){if(!t)return console.error("No context provided.");const r=e*this.actualTileSize,d=h*this.actualTileSize,a=i.x*this.actualTileSize,f=i.y*this.actualTileSize;t.save(),t.translate(r+this.actualTileSize/2,d+this.actualTileSize/2),t.rotate(n*Math.PI/180),t.drawImage(this.tileSheet,a,f,this.actualTileSize,this.actualTileSize,-this.actualTileSize/2,-this.actualTileSize/2,this.actualTileSize,this.actualTileSize),t.restore()}}function Zt(s){return lt({image:s,frameWidth:16,frameHeight:22,animations:{idle:{frames:"0..1",frameRate:2},walk:{frames:"2..5",frameRate:8},hurt:{frames:"5..6",frameRate:8},splash:{frames:"4",frameRate:0,loop:!1},zI:{frames:"6..7",frameRate:2},zombieWalk:{frames:"8..11",frameRate:8},zH:{frames:"12..13",frameRate:8},zS1:{frames:"10",frameRate:0,loop:!1},zS2:{frames:"11",frameRate:0,loop:!1}}})}const S={g:"#2b4432",w:"#374952",s:"#9d7e6a",uG:"#41772f",uY:"#edc06d",uO:"#db6136",uR:"#ae3b2f",uP:"#7f417c",uW:"#c8cdcc",uCd:"#000000dd"};function jt(s,t,i){return new Vt(s,t,{g:{background:i.g},w:{background:i.w},f:{x:2,y:1},iC:{x:0,y:0},oC:{x:1,y:0},b:{x:2,y:0},s:{background:i.s},r:{x:1,y:1},wv:{x:0,y:1},t:{x:4,y:0}})}function Kt(s,t,i,e){return T({x:0,y:0,gx:s.x,gy:s.y,dx:t.x,dy:t.y,radius:2,color:S.uY,damage:20,speed:200,moveX:0,moveY:0,isColliding:!1,ttl:60,render(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill()},update(h){h!==void 0&&(this.gx+=this.moveX,this.gy+=this.moveY,this.x=this.gx-e.gx+i.width/2,this.y=this.gy-e.gy+i.height/2,this.advance())},setMovement(h,n){h!==void 0&&(n==null||n.forEach(r=>{if(tt({position:this.nextPosition(),radius:this.radius},B(r))){const d=r.x-this.gx,a=r.y-this.gy,f=Math.sqrt(d*d+a*a);this.moveX=d/f*this.speed*h,this.moveY=a/f*this.speed*h,this.isColliding=!0,r.takeDamage(this.damage)}}),this.isColliding||(this.moveX=this.dx?this.dx*this.speed*h:0,this.moveY=this.dy?this.dy*this.speed*h:0))},nextPosition(h){if(h===void 0)return{x:this.gx,y:this.gy};const n=this.gx+(this.dx?this.dx*this.speed*h:0),r=this.gy+(this.dy?this.dy*this.speed*h:0);return{x:n,y:r}},getPosition(){return{x:this.gx,y:this.gy}},getBounds(){return{left:this.gx-this.radius,right:this.gx+this.radius,top:this.gy-this.radius,bottom:this.gy+this.radius}},getExtendedBounds(h){if(h===void 0)return;let n=this.getBounds();return{left:n.left-this.speed*h,right:n.right+this.speed*h,top:n.top-this.speed*h,bottom:n.bottom+this.speed*h}}})}function Qt(s,t,i,e){return T({x:0,y:0,gx:s.x,gy:s.y,dx:t.x,dy:t.y,radius:1,color:S.uY,speed:200,ttl:5,isColliding:!1,render(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill()},update(h){h!==void 0&&(this.gx+=this.dx?this.dx*this.speed*h:0,this.gy+=this.dy?this.dy*this.speed*h:0,this.x=this.gx-e.gx+i.width/2,this.y=this.gy-e.gy+i.height/2,this.radius*=.8,this.advance())}})}function Jt(s,t,i){return[{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:-1}].map(h=>Qt(s,h,t,i))}function ut(s,t,i){return T({x:0,y:0,gx:s.x,gy:s.y,radius:40,color:S.uP+"77",render(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill()},update(e){e!==void 0&&(this.x=this.gx-i.gx+t.width/2,this.y=this.gy-i.gy+t.height/2,this.advance())},setPos(e){this.gx=e.x+i.gx-t.width/2,this.gy=e.y+i.gy-t.height/2},explode(e){return Xt(),e.forEach(h=>{tt(B(h),B(this))&&h.takeDamage(100)}),ti({x:this.gx,y:this.gy},t,i)},getBounds(){return{left:this.gx-this.radius,right:this.gx+this.radius,top:this.gy-this.radius,bottom:this.gy+this.radius}}})}function ti(s,t,i){const e=[];for(let h=0;h<20;h++)e.push(T({x:0,y:0,gx:s.x,gy:s.y,duration:.5,radius:5,color:S.uP,render(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill()},update(n){n!==void 0&&(this.gx+=Math.random()*20-10,this.gy+=Math.random()*20-10,this.x=this.gx-i.gx+t.width/2,this.y=this.gy-i.gy+t.height/2,this.radius*=.9,this.duration-=n)}}));return e}function ii(s,t,i){return ut(s,t,i)}function ei(s,t,i){const e=ut(s,t,i);return e.color=S.uY+"55",e.radius=40,e.explode=function(h){return Nt(),si({x:this.gx,y:this.gy},t,i,h)},e}function si(s,t,i,e){const h=[];return h.push(T({x:0,y:0,gx:s.x,gy:s.y,duration:10,radius:40,color:S.uY+"44",lighterColor:S.uY+"99",grow:!0,bubbles:[],player:i,render(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill(),this.bubbles.forEach(n=>{this.context.fillStyle=n.color,this.context.beginPath(),this.context.arc(n.x-this.x,n.y-this.y,n.radius,0,2*Math.PI),this.context.fill()})},update(n){n!==void 0&&(this.x=this.gx-i.gx+t.width/2,this.y=this.gy-i.gy+t.height/2,this.duration-=n,this.bubbles.length<60&&this.gB(),this.bubbles.forEach(r=>{r.gy-=10*n,r.x=r.gx-i.gx+t.width/2,r.y=r.gy-i.gy+t.height/2,r.radius*=.95,r.duration-=n,r.duration<=0&&this.bubbles.splice(this.bubbles.indexOf(r),1),r.color=this.lighterColor}),e.forEach(r=>{tt(B(r),B(this))&&(r.speed=r.normalSpeed*.25)}))},gB(){const n=this.gx+Math.random()*this.radius*2-this.radius,r=this.gy+Math.random()*this.radius*2-this.radius;for(let d=this.bubbles.length;d<20;d++)this.bubbles.push({x:0,y:0,gx:n,gy:r,radius:5*Math.random(),color:this.lighterColor,duration:Math.random()*5})}})),h}const hi=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]];function V(s,t,i){return(1-i)*s+i*t}function Z(s,t){return(s%t+t)%t}function D(s,t,i,e,h){const n=Z(s,h.length),r=Z(t,h.length);let d=Z(h[n]+r,h.length),a=hi[d%12],f=i-s,p=e-t;return f*a[0]+p*a[1]}function ni(s,t,i){let e=Math.floor(s),h=e+1,n=Math.floor(t),r=n+1,d=s-e,a=t-n,f,p,o,c,l;return f=D(e,n,s,t,i),p=D(h,n,s,t,i),o=V(f,p,d),f=D(e,r,s,t,i),p=D(h,r,s,t,i),c=V(f,p,d),l=V(o,c,a),l}class ri{constructor(t,i,e){m(this,"width");m(this,"height");m(this,"tileset");m(this,"offscreenCanvas");m(this,"offscreenCtx");m(this,"secondOffscreenCanvas");m(this,"secondOffscreenCtx");m(this,"shorelines");m(this,"obstacles");m(this,"trees");m(this,"mapGrid");m(this,"directions");this.width=t,this.height=i,this.tileset=e,this.offscreenCanvas=new OffscreenCanvas(t,i),this.offscreenCtx=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0}),this.offscreenCtx&&(this.offscreenCtx.imageSmoothingEnabled=!1),this.secondOffscreenCanvas=new OffscreenCanvas(t,i),this.secondOffscreenCtx=this.secondOffscreenCanvas.getContext("2d",{willReadFrequently:!0}),this.secondOffscreenCtx&&(this.secondOffscreenCtx.imageSmoothingEnabled=!1),this.mapGrid=[],this.directions=["N","E","S","W"],this.shorelines=[],this.obstacles=[],this.trees=[]}generateMap(t,i){return new Promise((e,h)=>{if(!this.offscreenCtx)return h("No context provided.");const n=Math.floor(this.width/this.tileset.tileSize),r=Math.floor(this.height/this.tileset.tileSize),d=.1;for(let c=0;c<r;c++){this.mapGrid[c]=[];for(let l=0;l<n;l++){let x=(ni(l*d,c*d,t)+1)/2;const w=l-n/2,C=c-r/2,M=Math.sqrt(w*w+C*C),P=Math.sqrt(Math.pow(n/2,2)+Math.pow(r/2,2)),O=M/P;x=x-O*i,x<.32?(this.mapGrid[c][l]={x:l,y:c,type:"wv"},this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"w",l,c)):x<.45?(this.mapGrid[c][l]={x:l,y:c,type:"s"},this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"s",l,c)):x<.6?(this.mapGrid[c][l]={x:l,y:c,type:"g"},this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"g",l,c)):(this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"g",l,c),this.mapGrid[c][l]={x:l,y:c,type:"t"})}}this.cSDP(),this.cSTP(),this.nWTT(),this.cCM(),this.rST(),this.cSDP(),this.rST();const{cornerOuter:a,cornerInner:f,border:p,grass:o}=this.fTP(this.mapGrid);a.forEach(c=>{this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"oC",c.x,c.y,c.rotation)}),f.forEach(c=>{this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"iC",c.x,c.y,c.rotation)}),p.forEach(c=>{this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"b",c.x,c.y,c.rotation)}),o.forEach(c=>{this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,Math.random()>.7?"f":"g",c.x,c.y)}),this.mapGrid.forEach(c=>{c.forEach(l=>{l.type==="t"&&this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,l.type,l.x,l.y),l.type==="wv"&&Math.random()>.9&&!this.shorelines.find(x=>x.x===l.x&&x.y===l.y)&&this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"wv",l.x,l.y),l.type==="s"&&(this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,l.type,l.x,l.y),Math.random()>.9&&this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"r",l.x,l.y))})});for(let c=0;c<this.mapGrid.length;c++)for(let l=0;l<this.mapGrid[0].length;l++){const x=this.mapGrid[c][l];x.type==="wv"&&this.obstacles.push({x:l*this.tileset.tileSize,y:c*this.tileset.tileSize}),x.type==="t"&&(this.obstacles.push({x:l*this.tileset.tileSize,y:c*this.tileset.tileSize}),this.trees.push(T({gx:l*this.tileset.tileSize+this.tileset.tileSize/2,gy:c*this.tileset.tileSize+this.tileset.tileSize/2,radius:this.tileset.tileSize/2,takeDamage(w){return w},getBounds(){return{left:this.gx-this.radius,right:this.gx+this.radius,top:this.gy-this.radius,bottom:this.gy+this.radius}}})))}return e(this)})}cCM(){for(let t=0;t<this.mapGrid.length;t++)for(let i=0;i<this.mapGrid[0].length;i++){const e=this.mapGrid[t][i],h=this.cD(i,t,this.mapGrid,e.type);h.length==2&&h.forEach(n=>{switch(n){case"NW":this.cCS(i,t,n,e.type)&&(this.mapGrid[t][i].type=e.type==="g"?"s":"g");break;case"NE":this.cCS(i,t,n,e.type)&&(this.mapGrid[t][i].type=e.type==="g"?"s":"g");break;case"SE":this.cCS(i,t,n,e.type)&&(this.mapGrid[t][i].type=e.type==="g"?"s":"g");break;case"SW":this.cCS(i,t,n,e.type)&&(this.mapGrid[t][i].type=e.type==="g"?"s":"g");break}})}}cCS(t,i,e,h){var r,d;let n=[];switch(e){case"NW":n.push([t-1,i]),n.push([t,i-1]),n.push([t+1,i-1]),n.push([t+1,i]);break;case"NE":n.push([t-1,i-1]),n.push([t,i-1]),n.push([t+1,i]),n.push([t+1,i+1]);break;case"SE":n.push([t+1,i-1]),n.push([t+1,i]),n.push([t,i+1]),n.push([t-1,i+1]);break;case"SW":n.push([t+1,i+1]),n.push([t+1,i]),n.push([t-1,i]),n.push([t-1,i-1]);break}for(let a=0;a<n.length;a++)if(((d=(r=this.mapGrid[n[a][1]])==null?void 0:r[n[a][0]])==null?void 0:d.type)===h)return!1;return!0}cA(t,i,e,h){var r,d,a,f;const n=[];return((r=e[i][t-1])==null?void 0:r.type)===h&&n.push("N"),((d=e[i][t+1])==null?void 0:d.type)===h&&n.push("S"),((a=e[i+1])==null?void 0:a[t].type)===h&&n.push("E"),((f=e[i-1])==null?void 0:f[t].type)===h&&n.push("W"),n}cD(t,i,e,h){var r,d,a,f,p,o,c,l;const n=[];return((d=(r=e[i+1])==null?void 0:r[t-1])==null?void 0:d.type)===h&&n.push("NE"),((f=(a=e[i-1])==null?void 0:a[t-1])==null?void 0:f.type)===h&&n.push("NW"),((o=(p=e[i+1])==null?void 0:p[t+1])==null?void 0:o.type)===h&&n.push("SE"),((l=(c=e[i-1])==null?void 0:c[t+1])==null?void 0:l.type)===h&&n.push("SW"),n}fTP(t){const i=[],e=[],h=[],n=[],r=t.length,d=t[0].length;for(let a=0;a<r;a++)for(let f=0;f<d;f++){const p=t[a][f];if(p.type==="g"||p.type==="wv"){const o=this.cA(f,a,t,"s"),c=this.cD(f,a,t,"s");let l=0;if(c.length===1&&o.length===0){switch(p.type==="wv"&&this.sWTSL(f,a),c[0]){case"NE":l=0;break;case"NW":l=90;break;case"SW":l=180;break;case"SE":l=270;break}e.push({x:f,y:a,rotation:l})}else c.length>0&&o.length===2?(p.type==="wv"&&this.sWTSL(f,a),o.includes("N")&&o.includes("E")&&c.includes("NE")?l=0:o.includes("N")&&o.includes("W")&&c.includes("NW")?l=90:o.includes("S")&&o.includes("W")&&c.includes("SW")?l=180:o.includes("S")&&o.includes("E")&&c.includes("SE")&&(l=270),i.push({x:f,y:a,rotation:l})):o.length>0?(p.type==="wv"&&this.sWTSL(f,a),o.includes("N")?l=0:o.includes("E")?l=270:o.includes("S")?l=180:o.includes("W")&&(l=90),h.push({x:f,y:a,rotation:l})):(l=0,p.type!=="wv"&&n.push({x:f,y:a,rotation:l}))}}return{cornerOuter:i,cornerInner:e,border:h,grass:n}}sWTSL(t,i){this.shorelines.push({x:t,y:i})}rST(){for(let t=0;t<this.mapGrid.length;t++)for(let i=0;i<this.mapGrid[0].length;i++){const e=this.mapGrid[t][i];(e.type==="g"||e.type==="s"||e.type==="wv")&&this.directions.forEach(h=>{this.cISPT(i,t,e.type,h)&&(this.mapGrid[t][i].type=e.type==="g"||e.type==="wv"?"s":"g")})}}nWTT(){for(let t=0;t<this.mapGrid.length;t++)for(let i=0;i<this.mapGrid[0].length;i++){const e=this.mapGrid[t][i];(e.type==="g"||e.type==="s")&&this.cNB(i,t,e.type)&&(this.mapGrid[t][i].type=e.type==="g"?"s":"g")}}cNB(t,i,e){const h=e==="g"?"wv":"t",n=this.cA(t,i,this.mapGrid,h),r=this.cD(t,i,this.mapGrid,h);return n.length>0||r.length>0}cSTP(){for(let t=0;t<this.mapGrid.length;t++)for(let i=0;i<this.mapGrid[0].length;i++){const e=this.mapGrid[t][i];if(e.type==="g"||e.type==="wv"){const h=this.cA(i,t,this.mapGrid,e.type);h.length===2&&(h.includes("N")&&h.includes("S")&&(this.mapGrid[t][i].type="s"),h.includes("E")&&h.includes("W")&&(this.mapGrid[t][i].type="s"))}}}cSDP(){for(let t=0;t<this.mapGrid.length;t++)for(let i=0;i<this.mapGrid[0].length;i++){const e=this.mapGrid[t][i];if(e.type==="g"||e.type==="wv"){const h=this.cD(i,t,this.mapGrid,e.type),n=this.cD(i,t,this.mapGrid,"s");h.length===2&&(h.includes("NE")&&h.includes("SW")?n.includes("NW")&&n.includes("SE")&&(this.mapGrid[t][i].type="s"):h.includes("NW")&&h.includes("SE")&&n.includes("NE")&&n.includes("SW")&&(this.mapGrid[t][i].type="s"))}}}cISPT(t,i,e,h){var r,d;const n=[];switch(h){case"N":n.push([t-1,i]),n.push([t-1,i-1]),n.push([t,i-1]),n.push([t+1,i-1]),n.push([t+1,i]);break;case"E":n.push([t,i-1]),n.push([t+1,i-1]),n.push([t+1,i]),n.push([t+1,i+1]),n.push([t,i+1]);break;case"S":n.push([t-1,i]),n.push([t-1,i+1]),n.push([t,i+1]),n.push([t+1,i+1]),n.push([t+1,i]);break;case"W":n.push([t,i-1]),n.push([t-1,i-1]),n.push([t-1,i]),n.push([t-1,i+1]),n.push([t,i+1]);break}for(let a=0;a<n.length;a++)if(((d=(r=this.mapGrid[n[a][1]])==null?void 0:r[n[a][0]])==null?void 0:d.type)===e)return!1;return!0}getMapSection(t,i,e,h){if(!this.offscreenCtx)throw new Error("No context provided.");return this.offscreenCtx.getImageData(t,i,e,h)}getWorldMap(){if(!this.offscreenCtx)throw new Error("No context provided.");return this.offscreenCtx.getImageData(0,0,this.width,this.height)}getTreeTops(){if(!this.secondOffscreenCtx)throw new Error("No context provided.");return this.secondOffscreenCtx.getImageData(0,0,this.width,this.height)}}function oi(s){const t=ai(s),i=Array.from({length:256},(h,n)=>n);for(let h=i.length-1;h>0;h--){const n=Math.floor(t.next()*(h+1));[i[h],i[n]]=[i[n],i[h]]}const e=[];for(let h=0;h<512;h++)e[h]=i[h&255];return e}function ai(s){s=s||Math.floor(Math.random()*2147483648);function h(){return s=(1103515245*s+12345)%2147483648,s/2147483648}return{next:h}}function ci(s,t,i,e,h){const n=oi(s);return new ri(Math.floor(i),Math.floor(e),h).generateMap(n,t)}function ot(s){return T({x:0,y:0,w:s.canvas.width,h:20,tC:s.context,s:s.sc,p:s.p,gameState:s,render:function(){this.drawTopBar(),this.drawRectangle(1,2,60),this.drawHealthBar(),this.drawRectangle(65,2,44);for(let t=0;t<this.p.cooldowns.length-3;t++)this.drawRectangle(67+14*t,4,12,12),t===0&&this.drawGingerShotIcon(73+14*t,10),t===1&&this.drawVitamineCBombIcon(73+14*t,10),t===2&&this.drawLavenderCloudIcon(73+14*t,10),this.p.cooldowns[t]>0&&(this.drawCooldownOverlay(67+14*t,2),this.drawCooldownText(73+14*t,10,t));this.drawRectangle(this.w/2/this.s-15,2,30),this.drawTimerText(this.w/2,10),this.drawRectangle(this.w/this.s-26*this.s,2,26*this.s),this.drawScoreText(this.w/this.s-13*this.s,10)},drawTopBar(){this.context.fillStyle="#000",this.context.fillRect(0,0,this.w,this.h)},drawRectangle(t,i,e,h=16){this.tC.strokeStyle=S.uW,this.tC.lineWidth=1*this.s,this.tC.strokeRect(t*this.s,i*this.s,e*this.s,h*this.s)},drawHealthBar(){let t=this.p.health>0?this.p.health:0,i=this.p.maxHealth;t/i<.25?this.tC.fillStyle=S.uR:t/i<.5?this.tC.fillStyle=S.uO:t/i<.75?this.tC.fillStyle=S.uY:this.tC.fillStyle=S.uG,this.tC.fillRect(3*this.s,4*this.s,Math.floor(56*(t/i)*this.s),(this.h-8)*this.s)},drawGingerShotIcon(t,i){this.context.fillStyle=S.uY,this.context.beginPath(),this.context.arc(t,i,3,0,2*Math.PI),this.context.fill()},drawVitamineCBombIcon(t,i){this.context.fillStyle=S.uP,this.context.fillRect(t-1,i-3,2,6),this.context.fillRect(t-3,i-3,6,2),this.context.fillRect(t-2,i-1,4,1)},drawLavenderCloudIcon(t,i){this.context.fillStyle=S.uY,this.context.beginPath(),this.context.arc(t,i,2,0,2*Math.PI),this.context.fill(),this.context.beginPath(),this.context.arc(t+2,i,2,0,2*Math.PI),this.context.fill(),this.context.beginPath(),this.context.arc(t-2,i,2,0,2*Math.PI),this.context.fill(),this.context.beginPath(),this.context.arc(t,i+2,2,0,2*Math.PI),this.context.fill(),this.context.beginPath(),this.context.arc(t,i-2,2,0,2*Math.PI),this.context.fill()},drawCooldownOverlay(t,i){this.context.fillStyle=S.uCd,this.context.fillRect(t,i,12,12)},drawCooldownText(t,i,e){this.tC.fillStyle=S.uW,this.tC.font=`${8*this.s}px Impact`,this.tC.textAlign="center",this.tC.textBaseline="middle",this.tC.fillText(`${Math.ceil(this.p.cooldowns[e])}`,t*this.s,i*this.s)},drawTimerText(t,i){this.tC.fillStyle=S.uW,this.tC.font=`${8*this.s}px Impact`,this.tC.textAlign="center",this.tC.textBaseline="middle",this.tC.fillText(`${this.gameState.getTimerText()}`,t,i*this.s)},drawScoreText(t,i){this.tC.fillStyle=S.uW,this.tC.font=`${8*this.s}px Impact`,this.tC.textAlign="center",this.tC.textBaseline="middle",this.tC.fillText(`${this.gameState.getScoreText()}`,t*this.s,i*this.s)}})}function li(s){return T({x:0,y:0,canvas:s.canvas,tC:s.context,s:s.sc,gameState:s,update:function(){s.p.playAnimation("splash"),s.p.setScale(-.7*this.s,.7*this.s),s.p.x=this.canvas.width/2.1/this.s,s.p.y=this.canvas.height/1.4/this.s,s.zombies[0].playAnimation("zS1"),s.zombies[0].setScale(-.6*this.s,.6*this.s),s.zombies[0].x=this.canvas.width/1.7/this.s,s.zombies[0].y=this.canvas.height/1.42/this.s,s.zombies[1].playAnimation("zS2"),s.zombies[1].setScale(.5*this.s,.5*this.s),s.zombies[1].x=this.canvas.width/2.7/this.s,s.zombies[1].y=this.canvas.height/1.45/this.s,s.trees[0].setScale(.5*this.s,.5*this.s),s.trees[0].x=this.canvas.width/1.6/this.s,s.trees[0].y=this.canvas.height/1.7/this.s,s.trees[1].setScale(.36*this.s,.36*this.s),s.trees[1].x=this.canvas.width/2.7/this.s,s.trees[1].y=this.canvas.height/1.7/this.s},render:function(){this.context.fillStyle="#000",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.tC.fillStyle=S.uW,this.tC.font=`${20*this.s}px Impact`,this.tC.textAlign="center",this.tC.textBaseline="middle",this.tC.fillText("To Health With You!",this.canvas.width/2,this.canvas.height/4),this.tC.font=`${8*this.s}px Impact`,this.tC.fillText("Press space to start",this.canvas.width/2,this.canvas.height/2.7),s.trees[0].render(),s.trees[1].render(),s.zombies[0].render(),s.zombies[1].render(),s.p.render()}})}function di(s){return T({x:0,y:0,canvas:s.canvas,tC:s.context,scale:s.sc,p:s.p,render:function(){this.tC.fillStyle="#000",this.tC.fillRect(0,0,this.canvas.width,this.canvas.height),this.tC.fillStyle=S.uW,this.tC.font=`${15*this.scale}px Impact`,this.tC.textAlign="center",this.tC.textBaseline="middle",this.tC.fillText("Game Over!",this.canvas.width/2,this.canvas.height/3),this.tC.font=`${10*this.scale}px Impact`,this.tC.fillText(`Your score: ${s.p.score}`,this.canvas.width/2,this.canvas.height/2.2),this.tC.fillText("Press space to try again",this.canvas.width/2,this.canvas.height/1.8)}})}function fi(s){return T({x:0,y:0,canvas:s.canvas,tC:s.context,s:s.sc,p:s.p,render:function(){this.tC.fillStyle="#000",this.tC.fillRect(0,0,this.canvas.width,this.canvas.height),this.tC.fillStyle=S.uW,this.tC.font=`${15*this.s}px Impact`,this.tC.textAlign="center",this.tC.textBaseline="middle",this.tC.fillText("Congratulations! You made it!",this.canvas.width/2,this.canvas.height/3),this.tC.font=`${10*this.s}px Impact`,this.tC.fillText(`Your score: ${this.p.score}`,this.canvas.width/2,this.canvas.height/2.2),this.tC.fillText("Press space to play again",this.canvas.width/2,this.canvas.height/1.8)}})}class ui{constructor(t,i,e,h,n,r){m(this,"lt");m(this,"tp");m(this,"s");m(this,"p");m(this,"uiItems");m(this,"canvas");m(this,"context");m(this,"sc");m(this,"winner");m(this,"zombies");m(this,"trees");this.lt=t,this.tp=0,this.s=0,this.p=i,this.uiItems=[],this.canvas=e,this.context=e.getContext("2d"),this.sc=h,this.winner=!1,this.zombies=n,this.trees=r}update(t){this.s===1&&(this.tp+=t,this.tp>=this.lt&&(this.winner||(this.p.score*=2,this.winner=!0),this.setState(3))),this.uiItems.forEach(i=>i.update())}renderUI(){if(this.context){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(let t=0;t<this.uiItems.length;t++)this.uiItems[t].render()}}getTimerText(){let t=Math.floor(this.lt-this.tp),i=Math.floor(t/60),e=t-i*60,h=e<10?`0${e}`:`${e}`;return`${i}:${h}`}getScoreText(){let t=this.p.score.toString();for(;t.length<6;)t="0"+t;return`Score: ${t}`}setState(t){if(this.context!==null)switch(this.s=t,this.uiItems=[],this.canvas.height=this.canvas.width*.75,t){case 1:this.canvas.height=80,this.tp=0,this.p.resetLevel(),this.uiItems.push(ot(this));break;case 2:this.uiItems.push(di(this));break;case 3:this.uiItems.push(fi(this));break;default:this.uiItems.push(li(this));break}}reloadUI(){this.context!==null&&(this.uiItems=[],this.s===1&&this.uiItems.push(ot(this)))}}async function gi(){const[s,t]=await _t(),i=Zt(t);let{canvas:e}=yt();const h=document.getElementById("t"),n=16,r=jt(n,s,S),d={},a={x:0,y:0};e.addEventListener("mousemove",g=>{const b=e.getBoundingClientRect(),A=e.width/b.width,k=e.height/b.height;a.x=(g.clientX-b.left)*A,a.y=(g.clientY-b.top)*k}),e.addEventListener("mousedown",g=>{d[g.button]=!0}),e.addEventListener("mouseup",g=>{d[g.button]=!1});const f=e.width*8,p=e.height*11,o=Lt(f/2,p/2,e,i.animations),c=[],l=[],x=[],w=[],C=[],M=await ci(8,.5,f,p,r),P=[K(0,0,o,e,0,i.animations),K(0,0,o,e,0,i.animations)],O=lt({image:s,frameWidth:32,frameHeight:32,animations:{splash:{frames:"2",frameRate:0,loop:!1}}});h.width=e.offsetWidth;const y=new ui(180,o,h,h.width/e.width,P,[rt(O.animations),rt(O.animations)]);window.addEventListener("resize",()=>{h.width=e.offsetWidth,y.sc=h.width/e.width,y.reloadUI()}),y.setState(0);const v=pi(M,o,e),q=xi(M,o,e);let z=0;It({update:function(g){if(y.s===0||y.s===2||y.s===3)zt()&&o.cooldowns[3]===0&&y.setState(1);else if(y.s===1){const b=H(M.obstacles,o.getScreenBounds(),n),A=$t(M.trees,o.getScreenBounds());if(z+=g,z>=4*(1-y.tp/y.lt)+1&&(c.push(qt(o,e,n*2,b,i.animations)),z=0),kt(o),At()){const u=Ot();u[" "]&&o.cooldowns[1]===0&&(w.length===0&&o.cooldowns[3]===0?(w[0]=ii(_(),e,o),o.cooldowns[3]=.5,o.vcb=!0):o.vcb&&o.cooldowns[3]===0&&(w.splice(0,1),o.vcb=!1,o.cooldowns[3]=.5)),(u.e||u.q)&&o.cooldowns[2]===0&&(w.length===0&&o.cooldowns[3]===0?(w[0]=ei(_(),e,o),o.cooldowns[3]=.5,o.tc=!0):o.tc&&o.cooldowns[3]===0&&(w.splice(0,1),o.tc=!1,o.cooldowns[3]=.5))}if(U())if(o.cooldowns[0]===0&&!o.vcb&&!o.tc&&o.cooldowns[3]===0){o.cooldowns[3]=.5,o.cooldowns[0]=.5;const u=Ht(o.getScreenPosition(),_());l.push(Kt(o.getPosition(),u,e,o)),Bt()}else o.vcb&&w.length>0?(C.push(...w[0].explode(c)),w.splice(0,1),o.vcb=!1,o.cooldowns[3]=.5,o.cooldowns[1]=15):o.tc&&w.length>0&&(C.push(...w[0].explode(c)),w.splice(0,1),o.tc=!1,o.cooldowns[3]=.5,o.cooldowns[2]=15);x.forEach(u=>{u.update(g),u.ttl<=0&&x.splice(x.indexOf(u),1)}),l.forEach(u=>{u.setMovement(g,[...A,...c]),u.update(g),u.isColliding&&(u.ttl=0),u.ttl<=0&&(l.splice(l.indexOf(u),1),x.push(...Jt(u.getPosition(),e,o)))}),w.forEach(u=>{u.setPos(_()),u.update(g)}),C.forEach(u=>{u.update(g),u.duration<=0&&C.splice(C.indexOf(u),1)}),o.setBoundingObstacles(H(M.obstacles,o.getExtendedBounds(n),n)),o.reduceSpeedIfTakingDamage(),o.update(g),o.moveUnit(g),o.setAnimation();let k=0;c.forEach((u,R)=>{if(u.getDistanceToTarget()>e.width*1.5&&(u.health=0),u.getDistanceToTarget()<o.radius&&u.cooldowns[0]===0&&(o.takeDamage(u.damage),u.cooldowns[0]=1),u.health<=0){c.splice(R,1),k++;return}let G=H(M.obstacles,u.getExtendedBounds(n),n);u.updateCooldowns(g),u.setBoundingObstacles(G),u.setScreenPosition(),u.checkIfWithinViewport(),u.update(g),u.moveUnit(g),u.setAnimation(),u.cooldowns[4]===0&&(u.isTakingDamage=!1),u.speed=u.normalSpeed}),o.health<=0&&(w.splice(0,1),z=0,c.forEach(u=>{u.health=0}),y.setState(2)),o.score+=k*10*(1+k*.5),o.reset()}o.updateCooldowns(g),y.update(g)},render:function(){y.s===1&&(v.drawImage(),w.forEach(g=>{g.render()}),o.render(),c.forEach(g=>{g.isInViewPort&&(g.isTarget&&g.drawTargetMark(),g.render())}),C.forEach(g=>{g.render()}),l.forEach(g=>{g.render()}),x.forEach(g=>{g.render()}),q.drawImage()),y.renderUI()}}).start();function _(){return a}function E(g){return!!d[g]}function U(){return!!E(0)}}gi();function pi(s,t,i){const e=gt(s.getWorldMap());return pt(e,t,i)}function xi(s,t,i){const e=gt(s.getTreeTops());return pt(e,t,i)}function gt(s){const t=document.createElement("canvas");t.width=s.width,t.height=s.height;const i=t.getContext("2d");i==null||i.putImageData(s,0,0);const e=new Image;return e.src=t.toDataURL(),e}function pt(s,t,i){return T({x:0,y:0,player:t,image:s,anchor:{x:0,y:0},drawImage:function(){var e;(e=this.context)==null||e.drawImage(this.image,Math.round(this.player.gx-i.width/2),Math.round(this.player.gy-i.height/2),i.width,i.height,0,0,i.width,i.height)}})}
